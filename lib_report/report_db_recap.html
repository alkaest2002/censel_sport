{% extends "_base.html" %}

{% block style %}
<style>
    table tr th {
        padding: 6px;
    }

    tbody tbody td {
        padding: 3px;
    }

    .new-tables {
        display: flex;
        flex-wrap: wrap;
    }

    .new-table {
        flex: 1 1 calc(50% - 40px);
        box-sizing: border-box;
    }

    .new-table:nth-child(odd) {
        padding-right: 20px;
    }

    .new-table:nth-child(even) {
        padding-left: 20px;
    }

    .new-table > div {
        display: flex;
        justify-content: space-between;
    }

</style>
{% endblock %}

{% block body %}
<div class="page">
    <div class="content">
        <div>
            <div class="mb-xxl">
                <div class="header">
                    <h1 class="mb-xs">SINOSSI DELLE NUOVE TAVOLE DI CONVERSIONE</h1>
                    <p>Allegato {{ header }}</p>
                </div>
            </div>

            <!-- Page Content -->
            <div class="mb-xxl new-tables">
                {% for (key, table) in data %}
                    <div class="new-table">
                        <div class="mt-xl mb-xs">
                            {% set test = (key.split("_"))[:-1] | join("_") %}
                            {% set gender = key.split("_")[-1] %}
                            {% set row = table.iloc[0] %}
                            <span class="text-bold">
                                {{ test | test_label }} &mdash; {{ gender | gender_label | title }}
                            </span>
                            <span class="text-bold text-small">
                                allegato {{ row.header_letter.upper() }}, pag. {{ row.page_number }}
                            </span>
                        </div>
                        <table class="table-bordered full-width">
                            <thead>
                                <th class="text-center">FASCIA</th>
                                <th class="text-center">PUNTEGGIO</th>
                                <th class="text-center">LIMITE INFERIORE</th>
                                <th class="text-center">LIMITE SUPERIORE</th>
                            </thead>
                            <tbody>
                                {% for _, row in table.iterrows() %}
                                <tr>
                                    <td class="text-center text-bold">
                                        F{{ loop.index | int }}
                                    </td>
                                    <td class="text-center">
                                        {{ row.awarded_score | format_number_locale(precision=2) }}
                                    </td>
                                    <td class="text-center">
                                        {% if loop.first %}
                                            &mdash;
                                        {% else %}
                                            {% if row.metric_type == "continuous" %}
                                                {% if row.metric_subtype == "time" %}
                                                    da {{ (row.from + (1 / (10 ** row.metric_precision))) | format_seconds(row.metric_precision) }}
                                                {% else %}
                                                    da {{ (row.from + (1 / (10 ** row.metric_precision))) | round(row.metric_precision) }}
                                                {% endif %}
                                            {% else %}
                                                da {{ (row.from + 1) | format_number_locale(precision=row.metric_precision)}}
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if loop.last %}
                                        &mdash;
                                        {% else %}
                                            {% if row.metric_type == "continuous" %}
                                                {% if row.metric_subtype == "time" %}
                                                    fino a {{ row.to | format_seconds(row.metric_precision) }}
                                                {% else %}
                                                    fino a {{ row.to | format_number_locale(precision=row.metric_precision)}}
                                                {% endif %}
                                            {% else %}
                                                fino a {{ row.to | format_number_locale(precision=row.metric_precision)}}
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <div class="caption">
                                            <span>Tabella {{ header }}.{{ loop.index}}</span>
                                            {% set row = table.iloc[0] %}
                                            {% if row.metric_subtype == "time" %}
                                                <span>
                                                    precisione = {{ row.metric_precision_label }},
                                                        <span>
                                                            formato = minuti:secondi,decimi.        
                                                        </span>
                                                </span>
                                            {% else %}
                                                precisione = {{ row.metric_precision_label }}.
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="footer">{{ page }}</div>
    </div>
</div>
{% endblock %}