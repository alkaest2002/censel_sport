{% extends "_base.html" %}

{% block report_style %}
<style>
    .two-columns {
        column-width: 50ch;
        column-gap: 5rem;
    }

    .two-columns>* {
        break-inside: avoid;
    }

    img {
        width: 100%;
    }
</style>
{% endblock %}

{% block body %}
<div class="page">
    <h1 class="mb-md">CAMPIONE DI RIFERIMENTO</h1>
    <div class="two-columns">
        <h2>Introduzione</h2>
        <p>
            L'obiettivo principale del presente lavoro è la costruzione di tabelle di conversione che trasformino
            misurazioni grezze in
            punteggi standard basati sulla distribuzione percentilica del campione di riferimento. Queste
            tabelle permettono di interpretare un valore grezzo posizionandolo rispetto alla popolazione di riferimento
            e, eventualmente, di convertirlo in punteggio standard.
            La validità e l'utilità pratica di tali tabelle dipende dalla precisione e
            stabilità delle stime percentiliche utilizzate come soglie di conversione: percentili instabili producono
            tabelle poco affidabili nel tempo.

            La stabilità delle stime percentiliche richiede campioni di calibrazione con numerosità adeguata, poiché
            l'errore di stima aumenta drasticamente nelle code della distribuzione dove la densità di osservazioni è
            minore. Come linee guida operative: per percentili centrali e moderatamente estremi (10°-90°) sono
            raccomandabili almeno ~500 osservazioni per ottenere stime ragionevolmente stabili; per percentili
            semi-estremi (5°-95°) è preferibile disporre di ~2.000 casi; per percentili estremi (1°-3° e 97°-99°)
            sono spesso necessarie diverse migliaia di osservazioni (~5.000) per garantire soglie
            affidabili, specialmente in presenza di distribuzioni con code pesanti dove la variabilità campionaria è
            maggiore.
        </p>
        <p>Il fitting di una distribuzione teorica consiste nel processo di identificazione e stima dei parametri di un
            modello probabilistico che meglio descrive un campione di dati osservati. Questo procedimento inizia con la
            selezione di una famiglia di distribuzioni candidate {% if data.metric_config.metric_type == "time" %}(es.,
            normale, lognormale, gamma, weibull){% else %}(es., binomiale negativa, poisson, poisson con inflazione di
            zeri, ecc.){% endif %} basata sulla
            natura dei dati e su considerazioni teoriche del fenomeno studiato. Successivamente, si procede alla stima
            dei parametri caratteristici della distribuzione scelta utilizzando metodi statistici come la massima
            verosimiglianza. La qualità del fit viene valutata attraverso indici di bontà di adattamento che confrontano
            quanto bene il modello teorico riproduce le caratteristiche statistiche del campione osservato. Un buon
            fitting permette di fare inferenze statistiche robuste, generare predizioni affidabili e comprendere meglio
            la struttura probabilistica sottostante ai dati.</p>
        <h2>Descrittive del campione</h2>
        <table class="table-bordered full-width">
            <thead>
                <th class="text-left">STATISTICA</th>
                <th class="text-center">VALORE</th>
            </thead>
            <tbody>
                {% for key, value in data.clean.descriptive_stats.items() %}
                <tr>
                    <td class="text-left">{{ key | upper }}</td>
                    <td class="text-center">{{ "%.2f" | format(value) }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2"><span class="text-bold">Tabella 1.</span> COUNT = Frequenza, MEAN = media, STD = dev.ne standard, MIN = minimo, 25% = 25 percentile, 50% = mediana, 75% = 75 percentile, MAX = massimo.</td>
                </tr>
            </tfoot>
        </table>
        <h2>Fitting distribuzione teoriche</h2>
        <table class="table-bordered full-width">
            <thead>
                <tr>
                    <th class="text-left">MODELLO</th>
                    <th class="text-center">AIC</th>
                    <th class="text-center">BIC</th>
                    <th class="text-center">CVM</th>
                </tr>
            </thead>
            <tbody>
                {% for model_name, model_data in data.fit.fitted_models.items() %}
                <tr>
                    <td class="text-left">{{ model_name | upper }}</td>
                    <td class="text-center">{{ "%.2f" | format(model_data.goodness_of_fit.aic) }}</td>
                    <td class="text-center">{{ "%.2f" | format(model_data.goodness_of_fit.bic) }}</td>
                    <td class="text-center">
                        {{ "%.2f" | format(model_data.goodness_of_fit.cramer_von_mises) }} (p={{ "%.3f" |
                        format(model_data.goodness_of_fit.cvm_pvalue) }})
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4"><span class="text-bold">Tabella 2.</span> AIC = Akaike Information Criterion, BIC = Bayesian Information Criterion, CVM = Cramér-von Mises statistic.</td>
                </tr>
            </tfoot>
        </table>
        <h2>Grafici</h2>
        <div>
            <h3 class="text-center">ISTOGRAMMA DEL CAMPIONE</h3>
            <img src="{{ data.plots[0].svg }}" />
        </div>
        <div>
            <h3 class="text-center">Q-Q PLOT</h3>
            <img src="{{ data.plots[-1].svg }}" />
        </div>
    </div>
</div>
{% endblock %}